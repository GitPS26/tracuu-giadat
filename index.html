<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tra c·ª©u B·∫£ng gi√° ƒë·∫•t S∆°n La 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        
        /* T√πy ch·ªânh thanh cu·ªôn */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        .loader {
            border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #2563eb;
            width: 20px; height: 20px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* C·ªë ƒë·ªãnh Header b·∫£ng */
        .table-container { max-height: 70vh; overflow-y: auto; }
        thead th { position: sticky; top: 0; z-index: 10; background-color: #f8fafc; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        
        /* Mobile Tab scroll */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

    <header class="bg-blue-900 text-white shadow-md z-20 flex-none">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center mb-3">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white text-blue-900 rounded-lg flex items-center justify-center font-bold text-xl shadow">SL</div>
                    <div>
                        <h1 class="font-bold text-lg leading-none uppercase tracking-wide">Gi√° ƒê·∫•t S∆°n La</h1>
                        <p class="text-xs text-blue-200 mt-1">Ngh·ªã quy·∫øt 152/2025/NQ-HƒêND</p>
                    </div>
                </div>
                <button class="text-sm bg-blue-800 hover:bg-blue-700 px-3 py-1.5 rounded text-blue-100 transition">
                    <i class="fa-solid fa-circle-info mr-1"></i> 2026
                </button>
            </div>

            <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                <button onclick="app.switchTab('dat_o')" class="tab-btn whitespace-nowrap px-4 py-2 text-sm font-medium rounded-lg transition bg-white text-blue-900 shadow" data-tab="dat_o">üè° ƒê·∫•t ·ªû</button>
                <button onclick="app.switchTab('dat_tmdv')" class="tab-btn whitespace-nowrap px-4 py-2 text-sm font-medium rounded-lg transition text-blue-100 hover:bg-blue-800" data-tab="dat_tmdv">üè¢ TM-DV</button>
                <button onclick="app.switchTab('dat_sxkd')" class="tab-btn whitespace-nowrap px-4 py-2 text-sm font-medium rounded-lg transition text-blue-100 hover:bg-blue-800" data-tab="dat_sxkd">üè≠ SXKD</button>
                <button onclick="app.switchTab('dat_nn')" class="tab-btn whitespace-nowrap px-4 py-2 text-sm font-medium rounded-lg transition text-blue-100 hover:bg-blue-800" data-tab="dat_nn">üåæ N√¥ng Nghi·ªáp</button>
                <button onclick="app.switchTab('dat_kcn')" class="tab-btn whitespace-nowrap px-4 py-2 text-sm font-medium rounded-lg transition text-blue-100 hover:bg-blue-800" data-tab="dat_kcn">üèóÔ∏è KCN</button>
            </div>
        </div>
    </header>

    <section class="bg-white border-b border-slate-200 p-4 z-10 shadow-sm flex-none">
        <div class="container mx-auto flex flex-col md:flex-row gap-3">
            <div class="relative flex-grow">
                <i class="fa-solid fa-magnifying-glass absolute left-3 top-3 text-slate-400"></i>
                <input type="text" id="searchInput" placeholder="Nh·∫≠p t√™n x√£, t√™n ƒë∆∞·ªùng..." 
                    class="w-full pl-10 pr-10 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                <button id="clearSearch" class="hidden absolute right-3 top-3 text-slate-400 hover:text-slate-600">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="w-full md:w-72">
                <div class="relative">
                    <i class="fa-solid fa-location-dot absolute left-3 top-3 text-slate-400"></i>
                    <select id="areaSelect" class="w-full pl-9 pr-8 py-2.5 bg-slate-50 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 text-sm appearance-none cursor-pointer">
                        <option value="">-- T·∫•t c·∫£ X√£/Ph∆∞·ªùng --</option>
                    </select>
                    <i class="fa-solid fa-chevron-down absolute right-3 top-3.5 text-xs text-slate-400 pointer-events-none"></i>
                </div>
            </div>
        </div>
        <div class="container mx-auto mt-2 flex justify-between items-center text-xs text-slate-500">
            <span id="loadingIcon" class="hidden flex items-center gap-2"><div class="loader"></div> ƒêang t·∫£i d·ªØ li·ªáu...</span>
            <span id="recordCount" class="ml-auto">0 k·∫øt qu·∫£</span>
        </div>
    </section>

    <main class="flex-grow container mx-auto px-0 md:px-4 py-2 overflow-hidden flex flex-col">
        <div class="bg-white md:rounded-lg shadow border border-slate-200 flex-grow table-container relative">
            <table class="w-full text-left border-collapse">
                <thead class="bg-slate-50 text-slate-600 uppercase text-xs font-bold" id="tableHead">
                    </thead>
                <tbody class="text-sm divide-y divide-slate-100" id="tableBody">
                    </tbody>
            </table>
            
            <div id="emptyState" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-white z-0">
                <div class="bg-slate-100 p-4 rounded-full mb-3">
                    <i class="fa-solid fa-file-circle-xmark text-3xl text-slate-400"></i>
                </div>
                <p class="text-slate-500 font-medium">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu ph√π h·ª£p</p>
                <p class="text-xs text-slate-400 mt-1">Th·ª≠ t√¨m b·∫±ng t·ª´ kh√≥a kh√°c ho·∫∑c ch·ªçn "T·∫•t c·∫£ X√£/Ph∆∞·ªùng"</p>
            </div>
        </div>
    </main>

    <div id="adPopup" class="fixed bottom-4 right-4 z-50 w-80 bg-white rounded-xl shadow-2xl border border-slate-100 transform transition-all duration-500 translate-y-[150%] opacity-0">
        <div class="relative">
            <div class="bg-gradient-to-r from-yellow-400 to-orange-500 h-1.5 w-full rounded-t-xl"></div>
            <button onclick="app.closeAd()" class="absolute top-3 right-3 text-slate-300 hover:text-slate-500 transition"><i class="fa-solid fa-xmark text-lg"></i></button>
            <div class="p-4">
                <div class="flex items-center gap-2 mb-2">
                    <span class="bg-yellow-100 text-yellow-700 text-[10px] font-bold px-2 py-0.5 rounded uppercase">Qu·∫£ng c√°o</span>
                    <span class="text-xs text-slate-400">T√†i tr·ª£</span>
                </div>
                <h4 class="font-bold text-slate-800 text-sm mb-1">D·ªãch v·ª• ƒêo ƒë·∫°c & Ph√°p l√Ω Nh√† ƒë·∫•t</h4>
                <p class="text-xs text-slate-600 mb-3 leading-relaxed">H·ªó tr·ª£ l√†m s·ªï ƒë·ªè, chuy·ªÉn ƒë·ªïi m·ª•c ƒë√≠ch s·ª≠ d·ª•ng ƒë·∫•t, t√°ch th·ª≠a nhanh ch√≥ng t·∫°i S∆°n La.</p>
                <a href="#" class="block w-full bg-blue-600 hover:bg-blue-700 text-white text-center py-2 rounded-lg text-xs font-bold transition shadow-sm hover:shadow">Li√™n h·ªá t∆∞ v·∫•n ngay</a>
            </div>
        </div>
    </div>

    <script>
        const app = {
            // --- C·∫§U H√åNH LI√äN K·∫æT (Thay Link CSV c·ªßa b·∫°n v√†o ƒë√¢y) ---
            sources: {
                'dat_o': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQG4GE0-U9irRzG5TTM7a0gLEsHt4ZflFq5cybPtjW_TvQCKmcLsylPnn_ytWmUGHTtt6AOQct8HHIM/pub?gid=747438694&single=true&output=csv',
                'dat_tmdv': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQG4GE0-U9irRzG5TTM7a0gLEsHt4ZflFq5cybPtjW_TvQCKmcLsylPnn_ytWmUGHTtt6AOQct8HHIM/pub?gid=1579441763&single=true&output=csv',
                'dat_sxkd': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQG4GE0-U9irRzG5TTM7a0gLEsHt4ZflFq5cybPtjW_TvQCKmcLsylPnn_ytWmUGHTtt6AOQct8HHIM/pub?gid=1380150361&single=true&output=csv',
                'dat_nn': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQG4GE0-U9irRzG5TTM7a0gLEsHt4ZflFq5cybPtjW_TvQCKmcLsylPnn_ytWmUGHTtt6AOQct8HHIM/pub?gid=824618310&single=true&output=csv',
                'dat_kcn': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQG4GE0-U9irRzG5TTM7a0gLEsHt4ZflFq5cybPtjW_TvQCKmcLsylPnn_ytWmUGHTtt6AOQct8HHIM/pub?gid=1164290113&single=true&output=csv'
            },

            // T·ª´ ƒëi·ªÉn hi·ªÉn th·ªã t√™n c·ªôt cho ƒë·∫πp
            colMap: {
                'STT': 'STT',
                'Xa_Phuong': 'Khu v·ª±c (X√£/Ph∆∞·ªùng)',
                'Ten_Tuyen_Duong': 'T√™n Tuy·∫øn ƒê∆∞·ªùng / V·ªã tr√≠',
                // C·ªôt gi√° 5 v·ªã tr√≠
                'VT1': 'V·ªã tr√≠ 1', 'VT2': 'V·ªã tr√≠ 2', 'VT3': 'V·ªã tr√≠ 3', 'VT4': 'V·ªã tr√≠ 4', 'VT5': 'V·ªã tr√≠ 5',
                // C·ªôt N√¥ng nghi·ªáp
                'Dat_Trong_Lua': 'ƒê·∫•t Tr·ªìng L√∫a',
                'Dat_Trong_Lua_1_Vu': 'L√∫a 1 V·ª•',
                'Dat_Trong_Lua_Con_Lai': 'L√∫a c√≤n l·∫°i',
                'Dat_Cay_Lau_Nam': 'C√¢y L√¢u NƒÉm',
                'Dat_Cay_Hang_Nam': 'C√¢y H√†ng NƒÉm',
                'Dat_Rung_SX': 'R·ª´ng SX',
                // C·ªôt KCN
                'Gia_Dat': 'Gi√° ƒê·∫•t (ngh√¨n ƒë/m2)'
            },
            
            data: [],
            headers: [],
            currentTab: 'dat_o',
            debounceTimer: null,

            init: function() {
                this.switchTab('dat_o');
                
                // Event Listeners
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    document.getElementById('clearSearch').classList.toggle('hidden', !e.target.value);
                    clearTimeout(this.debounceTimer);
                    this.debounceTimer = setTimeout(() => this.filter(), 300);
                });

                document.getElementById('areaSelect').addEventListener('change', () => this.filter());
                
                document.getElementById('clearSearch').addEventListener('click', () => {
                    document.getElementById('searchInput').value = '';
                    document.getElementById('clearSearch').classList.add('hidden');
                    this.filter();
                });

                // Qu·∫£ng c√°o
                setTimeout(() => {
                    document.getElementById('adPopup').classList.remove('translate-y-[150%]', 'opacity-0');
                }, 4000);
            },

            closeAd: function() {
                document.getElementById('adPopup').classList.add('translate-y-[150%]', 'opacity-0');
            },

            switchTab: function(tabKey) {
                this.currentTab = tabKey;
                
                // Update Style Tab
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    if(btn.dataset.tab === tabKey) {
                        btn.className = "tab-btn whitespace-nowrap px-4 py-2 text-sm font-medium rounded-lg transition bg-blue-800 text-white shadow ring-2 ring-blue-300 ring-opacity-50";
                    } else {
                        btn.className = "tab-btn whitespace-nowrap px-4 py-2 text-sm font-medium rounded-lg transition text-blue-100 hover:bg-blue-800 hover:text-white";
                    }
                });

                this.fetchData(tabKey);
            },

            fetchData: function(key) {
                const url = this.sources[key];
                const loader = document.getElementById('loadingIcon');
                loader.classList.remove('hidden');

                // DEMO MODE: N·∫øu ch∆∞a thay link, t·∫°o d·ªØ li·ªáu m·∫´u
                if(!url || url.includes('LINK_CSV')) {
                    console.warn("Ch∆∞a c√≥ link CSV, ƒëang ch·∫°y ch·∫ø ƒë·ªô Demo");
                    this.mockData(key);
                    loader.classList.add('hidden');
                    return;
                }

                Papa.parse(url, {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        this.data = results.data;
                        // L·∫•y headers t·ª´ data th·ª±c t·∫ø ƒë·ªÉ ƒë·∫£m b·∫£o c·ªôt n√†o c√≥ th√¨ hi·ªán, kh√¥ng c√≥ th√¨ ·∫©n
                        this.headers = results.meta.fields || Object.keys(this.data[0]);
                        
                        this.populateAreas();
                        this.filter();
                        loader.classList.add('hidden');
                    },
                    error: (err) => {
                        alert('Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu. Vui l√≤ng ki·ªÉm tra Link Google Sheet.');
                        loader.classList.add('hidden');
                    }
                });
            },

            populateAreas: function() {
                const select = document.getElementById('areaSelect');
                select.innerHTML = '<option value="">-- T·∫•t c·∫£ X√£/Ph∆∞·ªùng --</option>';
                
                // L·∫•y danh s√°ch X√£ duy nh·∫•t t·ª´ c·ªôt 'Xa_Phuong'
                const areas = [...new Set(this.data.map(d => d.Xa_Phuong || '').filter(x => x))].sort();
                
                areas.forEach(area => {
                    const opt = document.createElement('option');
                    opt.value = area;
                    opt.textContent = area;
                    select.appendChild(opt);
                });
            },

            filter: function() {
                const term = this.removeAccents(document.getElementById('searchInput').value.toLowerCase());
                const selectedArea = document.getElementById('areaSelect').value;
                
                const filtered = this.data.filter(row => {
                    // 1. T√¨m ki·∫øm: ∆Øu ti√™n c·ªôt 'Dieu_Kien_Loc' n·∫øu c√≥ (nhanh h∆°n), n·∫øu kh√¥ng th√¨ g·ªôp c√°c c·ªôt kh√°c
                    let searchSource = "";
                    if (row.Dieu_Kien_Loc) {
                        searchSource = row.Dieu_Kien_Loc;
                    } else {
                        // Fallback cho b·∫£ng KCN ho·∫∑c N√¥ng nghi·ªáp n·∫øu kh√¥ng c√≥ Dieu_Kien_Loc
                        searchSource = (row.Ten_Tuyen_Duong || '') + ' ' + (row.Xa_Phuong || '');
                    }
                    
                    const matchSearch = this.removeAccents(searchSource.toLowerCase()).includes(term);

                    // 2. L·ªçc X√£
                    const matchArea = selectedArea === "" || row.Xa_Phuong === selectedArea;

                    return matchSearch && matchArea;
                });

                this.render(filtered);
            },

            render: function(rows) {
                const tbody = document.getElementById('tableBody');
                const thead = document.getElementById('tableHead');
                const empty = document.getElementById('emptyState');
                
                tbody.innerHTML = '';
                document.getElementById('recordCount').textContent = `${rows.length} k·∫øt qu·∫£`;

                if(rows.length === 0) {
                    empty.classList.remove('hidden');
                    thead.innerHTML = ''; // ·∫®n header khi kh√¥ng c√≥ data cho ƒë·∫πp
                    return;
                } else {
                    empty.classList.add('hidden');
                }

                // 1. RENDER HEADER ƒê·ªòNG
                // Lo·∫°i b·ªè c·ªôt 'Dieu_Kien_Loc' v√† c√°c c·ªôt r·ªóng kh√¥ng c·∫ßn thi·∫øt
                const ignoreCols = ['Dieu_Kien_Loc'];
                let displayCols = this.headers.filter(h => !ignoreCols.includes(h));
                
                // S·∫Øp x·∫øp l·∫°i th·ª© t·ª± c·ªôt n·∫øu c·∫ßn (ƒë∆∞a STT, X√£, T√™n ƒë∆∞·ªùng l√™n ƒë·∫ßu)
                // Logic: Filter gi·ªØ nguy√™n th·ª© t·ª± trong CSV, th∆∞·ªùng l√† OK.
                
                let hHtml = '<tr>';
                displayCols.forEach(h => {
                    // Map t√™n c·ªôt sang ti·∫øng Vi·ªát
                    let displayName = this.colMap[h] || h.replace(/_/g, ' ');
                    
                    // Style ri√™ng cho c√°c c·ªôt gi√°
                    let alignClass = (h.includes('VT') || h.includes('Gia') || h.includes('Dat_')) ? "text-right" : "text-left";
                    
                    hHtml += `<th class="px-4 py-3 border-b whitespace-nowrap bg-slate-50 text-slate-600 ${alignClass}">${displayName}</th>`;
                });
                hHtml += '</tr>';
                thead.innerHTML = hHtml;

                // 2. RENDER BODY (T·ªëi ƒëa 100 d√≤ng)
                const limit = rows.slice(0, 100);
                
                limit.forEach(row => {
                    let tr = '<tr class="hover:bg-blue-50 transition border-b border-slate-100">';
                    displayCols.forEach(col => {
                        let val = row[col] || '-';
                        
                        // Style t·ª´ng √¥
                        let classes = "px-4 py-3 text-slate-700 align-top";
                        
                        // Style ƒë·∫∑c bi·ªát
                        if(col === 'Ten_Tuyen_Duong') classes += " font-medium text-slate-900 min-w-[250px]";
                        if(col === 'Xa_Phuong') classes += " text-xs font-semibold text-slate-500 uppercase min-w-[120px]";
                        if(col === 'STT') classes += " text-center text-slate-400 font-mono text-xs w-10";
                        
                        // T√¥ m√†u gi√° ti·ªÅn
                        if((col.includes('VT') || col.includes('Gia') || col.includes('Dat_')) && val !== '-') {
                            classes += " text-right font-mono font-bold text-blue-700 whitespace-nowrap";
                        } else if ((col.includes('VT') || col.includes('Gia')) && val === '-') {
                             classes += " text-right text-slate-300"; // Gi√° r·ªóng th√¨ l√†m m·ªù
                        }

                        tr += `<td class="${classes}">${val}</td>`;
                    });
                    tr += '</tr>';
                    tbody.innerHTML += tr;
                });
            },

            removeAccents: function(str) {
                return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/ƒë/g, "d").replace(/ƒê/g, "D");
            },

            // D·ªØ li·ªáu m·∫´u (ch·ªâ hi·ªán khi ch∆∞a c√≥ Link CSV th·∫≠t)
            mockData: function(key) {
                let mocks = [];
                if(key === 'dat_nn') {
                     this.headers = ['STT', 'Xa_Phuong', 'Ten_Tuyen_Duong', 'Dat_Trong_Lua', 'Dat_Cay_Lau_Nam'];
                     mocks = [{STT:'1', Xa_Phuong: 'X√£ Demo', Ten_Tuyen_Duong: 'To√†n x√£', Dat_Trong_Lua: '60', Dat_Cay_Lau_Nam: '40'}];
                } else {
                     this.headers = ['STT', 'Xa_Phuong', 'Ten_Tuyen_Duong', 'VT1', 'VT2', 'VT3', 'VT4', 'VT5'];
                     mocks = [{STT:'1', Xa_Phuong: 'X√£ Demo', Ten_Tuyen_Duong: 'ƒê∆∞·ªùng m·∫´u (ch∆∞a c√≥ link CSV)', VT1: '1000', VT2: '800', VT3:'-', VT4:'-', VT5:'-'}];
                }
                this.data = mocks;
                this.populateAreas();
                this.render(mocks);
            }
        };

        // Kh·ªüi ch·∫°y
        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>